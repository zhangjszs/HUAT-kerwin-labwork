# 5-08 为什么说UDP是面向报文的。而TCP是面向字节流的
UDP是一种无连接的传输层协议，其设计目标是提供一种简单的、不可靠的数据传输服务。UDP之所以被称为“面向报文”，主要有以下几个原因：
1. **报文边界保留**：
    - UDP在传输数据时，会保留应用程序交付的数据报文的边界。也就是说，UDP不会对数据报文进行拆分或合并，而是直接将每个数据报文作为一个独立的单元进行传输。
    - 这意味着，发送端发送的每个UDP数据报文在接收端都会被完整地接收，不会与其他数据报文混合在一起。
2. **无连接性**：
    - UDP是无连接的协议，这意味着它在发送数据之前不需要建立连接。每个UDP数据报文都是独立的，彼此之间没有关联。
    - 这种无连接的特性使得UDP非常适合于那些需要快速传输数据且对可靠性要求不高的应用场景，如实时音视频传输、在线游戏等。
3. **简单的头部结构**：
    - UDP的头部非常简单，只有8个字节，包含源端口、目的端口、长度和校验和等基本信息。这种简单的头部结构使得UDP的数据传输开销较小，适合于传输小数据量的报文。
4. **不可靠性**：
    - UDP不提供数据传输的可靠性保证，如数据包的顺序、重复、丢失等问题。每个UDP数据报文都是独立的，发送端和接收端之间没有状态维护，因此UDP不会对数据报文进行重传或排序。
### TCP（传输控制协议）是面向字节流的
TCP是一种面向连接的、可靠的传输层协议，其设计目标是提供可靠的数据传输服务。TCP之所以被称为“面向字节流”，主要有以下几个原因：
1. **字节流抽象**：
    - TCP将应用程序交付的数据视为一个连续的字节流，而不是一个个独立的数据报文。TCP会将这些字节流分割成合适大小的数据段（segment）进行传输。
    - 这意味着，发送端发送的数据在接收端可能会被重新组合成与发送端不同的数据块，因为TCP不保留应用程序交付的数据边界。
2. **连接导向**：
    - TCP是面向连接的协议，这意味着在数据传输之前，发送端和接收端需要先建立一个连接。这个连接会在数据传输结束后被释放。
    - 这种连接导向的特性使得TCP非常适合于那些需要可靠数据传输的应用场景，如文件传输、网页浏览等。
3. **复杂的头部结构**：
    - TCP的头部比UDP复杂得多，包含源端口、目的端口、序列号、确认号、窗口大小、校验和等众多字段。这些字段用于实现TCP的可靠传输机制，如流量控制、拥塞控制、重传机制等。
4. **可靠性保证**：
    - TCP提供了一系列的可靠性保证机制，包括数据包的顺序、重复、丢失等问题。TCP会确保数据包按顺序到达接收端，并在必要时进行重传。
    - 这些机制使得TCP能够提供可靠的数据传输服务，但同时也增加了传输的开销和延迟。
# 5-23 主机A向主机B连续发送了两个TCP报文段，其序号分别是70和100
试问：
## (1)第一个报文段携带了多少字节的数据?
TCP报文段的序号是基于字节流的，每个字节的序号是唯一的。假设第一个报文段的序号是70，第二个报文段的序号是100。
- 第一个报文段的序号是70，表示该报文段的第一个字节的序号是70。
- 第二个报文段的序号是100，表示该报文段的第一个字节的序号是100。
第一个报文段携带的字节数=100−70=30第一个报文段携带的字节数=100−70=30
所以，**第一个报文段携带了30字节的数据**。
## (2)主机B收到第一个报文段后发回的确认中的确认号应当是多少？
TCP的确认号是期望接收的下一个字节的序号。主机B收到第一个报文段后，期望接收的下一个字节的序号应当是第一个报文段的最后一个字节的序号加1。
- 第一个报文段的序号是70，携带了30字节的数据。  
- 因此，第一个报文段的最后一个字节的序号是：
**70+30−1=99**
 **主机B收到第一个报文段后发回的确认中的确认号应当是100。**
## (3)如果B收到第二个报文段后发回的确认中的确认号是180，试问A发送的第二个 报文段中的数据有多少字节? 
TCP的确认号是期望接收的下一个字节的序号。主机B收到第二个报文段后，期望接收的下一个字节的序号是180。
- 第二个报文段的序号是100，表示该报文段的第一个字节的序号是100。
- 主机B期望接收的下一个字节的序号是180。
因此，第二个报文段携带的字节数可以通过计算确认号与第二个报文段的序号差值来确定：
第二个报文段携带的字节数=180−100=80第二个报文段携带的字节数=180−100=80
所以，**A发送的第二个报文段中的数据有80字节。**
## (4)如果A发送的第一个报文段丢失了，但第二个报文段到达了B。B在第二个报文 段到达后向A发送确认。试问这个确认号应为多少?
当第一个报文段丢失，但第二个报文段到达时，B会根据第二个报文段的序号来发送确认。
- 第二个报文段的序号是100，表示该报文段的第一个字节的序号是100。
- 由于第一个报文段丢失，B没有收到第一个报文段的数据，因此B期望接收的下一个字节的序号应当是第一个报文段的第一个字节的序号。
**因此，B在第二个报文段到达后向A发送的确认号应当是：70**
# 5-31 通信信道带宽为1 Gbits，端到端传播时延为10ms。TCP的发送窗口为65535字节。试问：可能达到的最大吞吐量是多少?信道的利用率是多少?
最大吞吐量可以通过计算发送窗口大小与往返时间（RTT）的比值来确定。
1. **计算往返时间（RTT）**：
    - 传播时延为10 ms，往返时间（RTT）为2倍的传播时延：
- $$\begin{align*}
\text{RTT} &= 2 \times 10 \text{ ms} = 20 \text{ ms} = 0.02 \text{ 秒}
\end{align*}$$
1. **计算最大吞吐量**：
    - 发送窗口大小为65535字节，转换为比特数：

$$\begin{align*}
65535 \text{ 字节} \times 8 \text{ 比特/字节} &= 524280 \text{ 比特} \\

\end{align*}$$
- 最大吞吐量（最大数据传输速率）为发送窗口大小除以RTT：
$$\begin{align*}
\text{最大吞吐量} &= \frac{524280 \text{ 比特}}{0.02 \text{ 秒}} = 26,214,000 \text{ 比特/秒} = 26.214 \text{ Mbps}
\end{align*}$$
#### (2) 信道的利用率

信道的利用率是最大吞吐量与信道带宽的比值。

1. **计算信道带宽**：
    
    - 信道带宽为1 Gbps，转换为Mbps：
$$1 Gbps=1,000 Mbps$$
1. **计算信道利用率**：
    
    - 信道利用率为最大吞吐量除以信道带宽：
$$\begin{align*}
\text{信道利用率} &= \frac{26.214 \text{ Mbps}}{1,000 \text{ Mbps}} = 0.026214 = 2.6214\%
\end{align*}$$
### 最终答案

(1) 可能达到的最大吞吐量是26.214 Mbps。

(2) 信道的利用率是2.6214%。

# 5-39 TCP的拥塞窗口cwnd大小与传输轮次n的关系如下表：

| n    | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  |
| ---- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| cwnd | 1   | 2   | 4   | 8   | 16  | 32  | 33  | 34  | 35  | 36  | 37  | 38  | 39  |

|n|14|15|16|17|18|19|20|21|22|23|24|25|26|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|cwnd|40|41|42|21|22|23|24|25|26|1|2|4|8|

## (1) 试画出如图5-24所示的拥塞窗口与传输轮次的关系曲线
![](photo/IMG20241118194428.jpg)
#### (2) 指明TCP工作在慢开始阶段的时间间隔。

慢开始工作的时间间隔为传输轮次的1至6和23至26。
#### (3) 指明TCP工作在拥塞避免阶段的时间间隔。

拥塞避免的时间间隔分别包括6至16和17至26。
#### (4) 在第16轮次和第22轮次之后发送方是通过收到三个重复的确认，还是通过超时检测到丢失了报文段？

- 第16轮次之后发送方通过快恢复方法来发送数据，因此可以断定为收到了三个重复的确认。
    
- 第22轮次之后发送方采用慢开始方法来发送数据，因此可以断定通过超时检测机制来确认报文段的丢失。
#### (5) 在第1轮次、第18轮次和第24轮次发送时，门限ssthresh分别被设置为多大？

- 在第1轮次，门限ssthresh设置为32。
    
- 在第18轮次，门限ssthresh设置为21。
    
- 在第24轮次，门限ssthresh设置为13。
#### (6) 在第几轮次发送出第70个报文段？

将各次传输轮次的发送数据相加可知，在第7轮次发送出第70个报文段。
#### (7) 假定在第26轮次之后收到了三个重复的确认，因而检测出了报文段的丢失，那么拥塞窗口cwnd和门限ssthresh应设置为多大？

在第26轮次后收到三个重复的确认，因此检测出报文段的丢失。根据拥塞控制的算法，应该采用快恢复算法：
- 门限ssthresh减半，设置为4。
- 拥塞窗口cwnd设置为慢开始门限ssthresh减半后的数值，因此也设置为4。